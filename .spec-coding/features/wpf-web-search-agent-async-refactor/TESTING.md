# WPF WebSearchAgent 异步流式重构 - 测试文档

## 测试概述
本文档描述了如何测试WPF WebSearchAgent的异步流式重构功能，确保所有组件正常工作并满足需求。

## 测试环境
- .NET 6.0 或更高版本
- Windows 10/11
- Visual Studio 2022
- 有效的API密钥（OpenAI和Brave Search）

## 测试用例

### 1. 功能测试

#### 1.1 异步节点测试
**测试目标**: 验证所有异步节点正常工作
**测试步骤**:
1. 启动应用程序
2. 配置有效的API密钥
3. 输入测试问题："What is .NET?"
4. 点击搜索按钮
5. 验证：
   - UI保持响应，不卡顿
   - 进度条实时更新
   - 中间消息显示决策过程
   - 最终结果显示

#### 1.2 进度报告测试
**测试目标**: 验证进度报告机制
**测试步骤**:
1. 观察进度条从0%到100%的变化
2. 验证中间消息显示：
   - 决策分析
   - 搜索查询
   - 搜索结果摘要
   - 答案生成过程

#### 1.3 取消功能测试
**测试目标**: 验证取消功能正常工作
**测试步骤**:
1. 开始一个搜索
2. 在过程中点击取消按钮
3. 验证：
   - 搜索立即停止
   - 显示"Cancelled"状态
   - UI恢复正常状态

### 2. 性能测试

#### 2.1 响应性测试
**测试目标**: 验证UI保持响应
**测试步骤**:
1. 启动搜索
2. 尝试拖动窗口
3. 尝试切换标签页
4. 验证：UI始终保持响应

#### 2.2 内存使用测试
**测试目标**: 验证内存使用合理
**测试步骤**:
1. 使用任务管理器监控内存使用
2. 进行多次搜索
3. 验证：内存使用增长不超过100MB

### 3. 错误处理测试

#### 3.1 无效API密钥测试
**测试目标**: 验证错误处理
**测试步骤**:
1. 使用无效的API密钥
2. 进行搜索
3. 验证：显示友好的错误消息

#### 3.2 网络错误测试
**测试目标**: 验证网络错误处理
**测试步骤**:
1. 断开网络连接
2. 进行搜索
3. 验证：显示网络错误消息

### 4. 集成测试

#### 4.1 完整流程测试
**测试目标**: 验证完整搜索流程
**测试步骤**:
1. 配置有效API密钥
2. 输入复杂问题："Compare .NET 6 and .NET 8 performance"
3. 观察完整流程：
   - 决策分析
   - 多次搜索（如果需要）
   - 最终答案生成

### 5. 边界条件测试

#### 5.1 空输入测试
**测试目标**: 验证空输入处理
**测试步骤**:
1. 不输入任何问题
2. 点击搜索
3. 验证：显示"Please enter a question"

#### 5.2 长问题测试
**测试目标**: 验证长问题处理
**测试步骤**:
1. 输入超过500字符的问题
2. 验证：系统正常处理

## 测试数据

### 测试问题集
1. "What is .NET?"
2. "Compare .NET 6 and .NET 8"
3. "Latest features in C# 12"
4. "How to implement async/await in C#"
5. "Best practices for WPF MVVM"

### 预期结果
- 所有测试问题都能成功处理
- UI始终保持响应
- 进度报告准确
- 错误处理友好

## 性能基准

### 响应时间
- 首次搜索：< 2秒
- 后续搜索：< 1.5秒
- 取消响应：< 500ms

### 内存使用
- 初始内存：< 50MB
- 峰值内存：< 150MB
- 搜索后内存回落

## 测试工具

### 手动测试
- Visual Studio调试器
- Windows任务管理器
- 网络监控工具

### 自动化测试
- 单元测试框架
- UI自动化测试

## 测试报告模板

### 测试执行记录
```
测试日期: [日期]
测试人员: [姓名]
测试环境: [环境描述]
测试结果: [通过/失败]
备注: [其他信息]
```

## 已知问题
- 首次加载可能较慢（API连接建立）
- 网络延迟可能影响响应时间

## 修复建议
- 添加缓存机制
- 优化API调用
- 添加重试机制